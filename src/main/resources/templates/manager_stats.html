<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–ø—Ä–æ—Å–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .progress { height: 25px; border-radius: 12px; }
        .card-stats { border-left: 5px solid #0d6efd; }
    </style>
</head>
<body class="bg-light">
<div class="container mt-5 pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="bi bi-pie-chart-fill me-2"></i>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
        <div>
            <a href="/manager" class="btn btn-outline-secondary btn-sm">–ò—Å–∫–∞—Ç—å –¥—Ä—É–≥–æ–π</a>
            <a href="/home" class="btn btn-primary btn-sm">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>

    <!-- –ë–õ–û–ö –û–ë–©–ï–ô –ò–ù–§–û–†–ú–ê–¶–ò–ò -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm p-3 text-center">
                <h6 class="text-muted">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h6>
                <h2 th:text="${count}" class="fw-bold text-primary">0</h2>
            </div>
        </div>
    </div>

    <div th:if="${submissions.empty}" class="text-center mt-5">
        <h4>–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ—à–µ–ª —ç—Ç–æ—Ç —Ç–µ—Å—Ç üòî</h4>
    </div>

    <div th:unless="${submissions.empty}">
        <!-- 1. –°–ï–ö–¶–ò–Ø –°–£–ú–ú–ê–†–ù–´–• –ì–†–ê–§–ò–ö–û–í -->
        <h5 class="mb-3">–°–≤–æ–¥–∫–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º:</h5>
        <div class="row g-3 mb-5">
            <div th:each="q : ${survey.questions}" class="col-md-6">
                <div class="card shadow-sm p-3 card-stats">
                    <p class="fw-bold mb-2" th:text="${q.text}">–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</p>
                    <div class="progress mb-2">
                        <!-- YES bar -->
                        <div class="progress-bar bg-success" role="progressbar"
                             th:style="'width: ' + (${count} > 0 ? (${stats.get(q.id).get('YES')} * 100 / ${count}) : 0) + '%'"
                             th:text="${stats.get(q.id).get('YES')}"></div>
                        <!-- NOT SURE bar -->
                        <div class="progress-bar bg-secondary" role="progressbar"
                             th:style="'width: ' + (${count} > 0 ? (${stats.get(q.id).get('NOT_SURE')} * 100 / ${count}) : 0) + '%'"
                             th:text="${stats.get(q.id).get('NOT_SURE')}"></div>
                        <!-- NO bar -->
                        <div class="progress-bar bg-danger" role="progressbar"
                             th:style="'width: ' + (${count} > 0 ? (${stats.get(q.id).get('NO')} * 100 / ${count}) : 0) + '%'"
                             th:text="${stats.get(q.id).get('NO')}"></div>
                    </div>
                    <div class="d-flex justify-content-between small text-muted">
                        <span>–î–∞: [[${stats.get(q.id).get('YES')}]]</span>
                        <span>–ù–µ —É–≤–µ—Ä–µ–Ω: [[${stats.get(q.id).get('NOT_SURE')}]]</span>
                        <span>–ù–µ—Ç: [[${stats.get(q.id).get('NO')}]]</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. –¢–ê–ë–õ–ò–¶–ê –° –ü–û–ò–°–ö–û–ú -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º:</h5>
            <input type="text" id="tableSearch" class="form-control form-control-sm w-25" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email...">
        </div>

        <div class="table-responsive shadow-sm rounded-3">
            <table class="table table-white table-hover align-middle mb-0" id="resultsTable">
                <thead class="table-dark">
                <tr>
                    <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                    <th>Email</th>
                    <th>–û—Ç–≤–µ—Ç—ã</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="sub : ${submissions}">
                    <td>
                        <div class="fw-bold" th:text="${sub.user.name} + ' ' + ${sub.user.surname}">–ò–º—è –§–∞–º–∏–ª–∏—è</div>
                    </td>
                    <td th:text="${sub.user.email}">Email</td>
                    <td>
                        <span th:each="ans : ${sub.answers}" class="me-1">
                            <span th:if="${ans.value.name() == 'YES'}" class="badge rounded-pill bg-success" th:title="${ans.question.text}">–î–∞</span>
                            <span th:if="${ans.value.name() == 'NO'}" class="badge rounded-pill bg-danger" th:title="${ans.question.text}">–ù–µ—Ç</span>
                            <span th:if="${ans.value.name() == 'NOT_SURE'}" class="badge rounded-pill bg-secondary" th:title="${ans.question.text}">?</span>
                        </span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- JS –¥–ª—è –∂–∏–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ -->
<script>
    document.getElementById('tableSearch').addEventListener('keyup', function() {
        let value = this.value.toLowerCase();
        let rows = document.querySelectorAll('#resultsTable tbody tr');

        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(value) ? '' : 'none';
        });
    });
</script>

</body>
</html>